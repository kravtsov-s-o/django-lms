{% extends 'school/base-template.html' %}
{% load static %}
{% load extract_students %}
{% block extra_css %}
<!--  Custom  -->
<link rel="stylesheet" href="{% static './vendor/libs/quill/typography.css' %}"/>
<link rel="stylesheet" href="{% static './vendor/libs/quill/katex.css' %}"/>
<link rel="stylesheet" href="{% static './vendor/libs/quill/editor.css' %}"/>
{% endblock %}

{% block page-title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid flex-grow-1 container-p-y">
    <div class="card mb-4">
        <div class="card-body">
            <div class=" d-flex flex-wrap justify-content-between align-items-center gap-3 w-100">
                <h1 class="h2 m-0">Schedule</h1>
                <a href="{% url 'school:lesson-add' %}" class="btn btn-primary">Add lesson</a>
            </div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb m-0">
                </ol>
            </nav>
        </div>
    </div>
    <div class="row">
        <div class="col-xl-3">
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="h5 card-title m-0">Calendar</h2>
                </div>
                <hr class="m-0">
                <div class="card-body">
                    <form action="{% url 'school:main' %}" method="GET">
                        <label for="lessons-date" class="form-label">Choose date</label>
                        <div class="d-flex gap-1">
                            <input id="lessons-date" name="date" type="date" class="form-control mb-1" placeholder="YYYY-MM-DD"
                                   value="{{date|date:'Y-m-d'}}">
                            <button type="submit" class="btn btn-icon btn-outline-primary"><span
                                    class=" tf-icons bx bx-search"></span></button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="h5 card-title mb-0">Wallet</h2>
                </div>
                <hr class="m-0">
                <div class="card-body d-flex align-items-end justify-content-between">
                    <div class="d-flex justify-content-between align-items-center gap-3 w-100">
                        <div class="d-flex align-content-center w-50" style="position: relative;">
                            <div class="chart-info">
                                <h5 class="mb-0">$120</h5>
                                <small class="text-muted">Today</small>
                            </div>
                        </div>
                        <div class="d-flex align-content-center w-50" style="position: relative;">
                            <div class="chart-info">
                                <h5 class="mb-0">$640</h5>
                                <small class="text-muted">Month</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-9">
            <div class="card">
                <div class="card-header d-flex flex-wrap justify-content-between align-items-center w-100 gap-3">
                    <span class="h5 m-0">{{date|date:"d.m.Y"}}</span>
                </div>
                <hr class="m-0">
                {% if lessons %}
                <div class="card-table">
                    <div class="table-responsive text-nowrap">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Students</th>
                                <th class="text-center" style="width: 1%;">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="table-border-bottom-0">
                            {% for lesson in lessons %}
                            <tr>
                                <td>{{ lesson.time|time:"H:i" }}</td>
                                <td><span class="badge bg-label-info">{{ lesson.status }}</span></td>
                                <td>{{ lesson.students|extract_students }}</td>
                                <td style="width: 1%;">
                                    <div class="dropdown btn-group">
                                        <a href="{% url 'school:lesson-view' pk=lesson.id %}" class="btn btn-icon btn-outline-secondary">
                                            <i class='bx bx-show'></i>
                                        </a>
                                        <button type="button"
                                                class="btn btn-icon btn-outline-secondary p-0 dropdown-toggle hide-arrow"
                                                data-bs-toggle="dropdown" aria-expanded="true">
                                            <i class="bx bx-dots-vertical-rounded"></i>
                                        </button>
                                        <div class="dropdown-menu hide"
                                             data-popper-placement="bottom-start"
                                             style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate(1225px, 139px);">
                                            <a class="dropdown-item" href="{% url 'school:lesson-edit' pk=lesson.id %}">
                                                <i class="bx bx-edit-alt me-1"></i>Edit</a>
                                            <a class="dropdown-item" href="javascript:void(0);"
                                               data-bs-toggle="modal" data-bs-target="#success"><i
                                                    class="bx bx-check me-1"></i> Complete</a>
                                            <a class="dropdown-item" href="javascript:void(0);"
                                               data-bs-toggle="modal" data-bs-target="#missed"><i
                                                    class="bx bx-x me-1"></i> Miss</a>
                                            <a class="dropdown-item" href="javascript:void(0);"
                                               data-bs-toggle="modal" data-bs-target="#move"><i
                                                    class="bx bx-right-arrow-circle me-1"></i>Move</a>
                                            <a class="dropdown-item" href="javascript:void(0);"
                                               data-bs-toggle="modal" data-bs-target="#delete"
                                            data-whatever="{{lesson}}"><i
                                                    class="bx bx-trash me-1"></i> Delete</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% else %}
                <div class="card-body">
                    Lesson list is empty
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Modal Success -->
{% include 'school/modals/lesson-success.html' %}
<!-- / Modal Success -->
<!-- Modal Missed -->
{% include 'school/modals/lesson-miss.html' %}
<!-- / Modal Missed -->
<!-- Modal Cancel -->
{% include 'school/modals/lesson-cancel.html' %}
<!-- / Modal Cancel -->
<!-- Modal Delete -->
{% include 'school/modals/lesson-delete.html' %}
<!-- / Modal Delete -->
<!-- Modal Move  -->
{% include 'school/modals/lesson-move.html' %}
<!-- / Modal Move -->
{% endblock %}
{% block extra_js %}
<script src="{% static './js/forms-pickers.js' %}"></script>
<script src="{% static './js/ui-modals.js' %}"></script>
<script src="{% static './vendor/libs/flatpickr/flatpickr.js' %}"></script>
<script src="{% static './vendor/libs/quill/quill.js' %}"></script>
<script src="{% static './vendor/libs/quill/katex.js' %}"></script>

{% endblock %}